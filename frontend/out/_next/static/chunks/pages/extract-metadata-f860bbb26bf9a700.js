(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{2639:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/extract-metadata",function(){return a(2831)}])},2995:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(5105),s=a(1153),l=a.n(s);let n=()=>(0,r.jsxs)(l(),{children:[(0,r.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,r.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},4398:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var r=a(5105),s=a(8101),l=a(8394),n=a(6788),o=a(8161),d=a(4799);let i=e=>{let{id:t,userType:a,children:i,rootClassNames:c="",contentClassNames:m="max-h-full h-full",containerClassNames:u="flex flex-col md:min-h-screen relative container mx-auto"}=e,[p,h]=(0,s.useState)([]),x=(0,l.useRouter)(),b=e=>{x.push(e)},g=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),b("/log-in")},f=(0,o.usePathname)();return(0,s.useEffect)(()=>{h(("admin"==a?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"align-model",title:"Align Model",href:"/align-model"}]},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:g}]:a?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:g}]:[]).map(e=>(e.current=e.href==f,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==f,e))),e)))},[a]),(0,r.jsxs)("div",{className:(0,d.QP)(u,c),children:[p.length?(0,r.jsx)(n.jq,{rootClassNames:(0,d.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:p.map(e=>({...e,classNames:(0,d.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)("div",{className:m,children:i})]})}},2831:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Q});var r=a(5105),s=a(8101),l=a(8394),n=a(2995),o=a(8171),d=a(8137),i=a(2583),c=a(9226),m=a(8301),u=a(6788),p=a(2889),h=a.n(p);let x=e=>{let{token:t,dbInfo:a,onUpdate:l=()=>{}}=e,[n,p]=(0,s.useState)(a.tables||[]),[x,b]=(0,s.useState)(a.selected_tables||[]),[g,f]=(0,s.useState)((null==a?void 0:a.metadata)||[]),[y,j]=(0,s.useState)({}),[v,w]=(0,s.useState)(!1),k=a.db_name,N=(0,s.useContext)(u.oS);(0,s.useEffect)(()=>{f((null==a?void 0:a.metadata)||[]),p((null==a?void 0:a.tables)||[]),b((null==a?void 0:a.selected_tables)||[])},[a]);let _=(0,s.useCallback)(h()(async e=>{try{let a=await fetch((0,m.A)("http","integration/update_metadata"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({metadata:e,token:t,db_name:k})});if(!a.ok)throw Error("Error updating metadata");let r=await a.json();l(k,r),N.success("Metadata updated successfully")}catch(e){N.error("Error updating metadata:")}},500),[k]),C=(e,t)=>{let a=e.target.value,r=g.map(e=>"".concat(e.table_name,"_").concat(e.column_name)===t?{...e,column_description:a}:e);f(r),_(r)},S=(0,s.useMemo)(()=>[{label:"All tables",value:"all"},{label:"Clear all",value:"clear"},...a.tables.map(e=>({label:e,value:e}))],[a]),A=async()=>{console.log("Received tables: ",x),w(!0);try{N.info("Scanning selected tables.");let e=await fetch((0,m.A)("http","integration/generate_metadata"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tables:x,token:t,db_name:k})});if(!e.ok)throw Error("Could not extract metadata from tables");let a=await e.json();l(k,a)}catch(e){console.log(e),N.error("Error fetching metadata - please look at your docker logs for more information.")}finally{w(!1)}},E=[{title:"Table Name",dataIndex:"table_name",key:"table_name",width:"20%",align:"left",render:e=>(0,r.jsx)("span",{className:"p-2 font-bold",children:e})},{title:"Column Name",dataIndex:"column_name",key:"column_name",width:"20%",align:"left",render:e=>(0,r.jsx)("span",{className:"p-2 font-semibold",children:e})},{title:"Data Type",dataIndex:"data_type",key:"data_type",width:"20%",align:"left",render:e=>(0,r.jsx)("span",{className:"p-2 font-mono",children:e})},{title:"Description (Edit to update)",dataIndex:"column_description",key:"column_description",width:"35%",align:"left",render:(e,t)=>{let a="".concat(t.table_name,"_").concat(t.column_name);return(0,r.jsx)(u.fs,{defaultValue:e,autoResize:!0,defaultRows:1,onChange:e=>C(e,a),textAreaClassNames:"resize-none outline-transparent shadow-none"})}}],D=g.map(e=>({key:"".concat(e.table_name,"_").concat(e.column_name),...e})),O=async()=>{let e=await fetch((0,m.A)("http","integration/get_metadata"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,db_name:k,format:"csv"})}),a=await e.json();if(a.error)N.error(a.error);else{let e=window.URL.createObjectURL(new Blob([a.metadata])),t=document.createElement("a");t.href=e,t.setAttribute("download","metadata.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}},T=async()=>{let e=document.createElement("input");e.type="file",e.accept=".csv",e.onchange=async e=>{let a=e.currentTarget.files[0],r=new FileReader;r.onload=async e=>{let a=e.target.result,r=await fetch((0,m.A)("http","integration/upload_metadata"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,db_name:k,metadata_csv:a})});if(r.ok)l(k,await r.json()),N.success("Metadata uploaded successfully!");else{N.error("Error uploading metadata");return}},r.readAsText(a)},w(!0),e.click(),w(!1)};return v?(0,r.jsxs)("div",{className:"relative space-y-4",children:[(0,r.jsxs)("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-white/70 dark:bg-gray-900/70 backdrop-blur-[1px]",children:[(0,r.jsx)(u.c5,{classNames:"text-blue-500 h-6 w-6"}),(0,r.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-300",children:"Fetching metadata..."})]}),(0,r.jsx)("div",{className:"pointer-events-none",children:(0,r.jsx)("div",{className:"space-y-2 p-4",children:(0,r.jsx)("div",{className:"text-lg font-medium text-center dark:text-dark-text-primary",children:"View and Update Metadata"})})})]}):(0,r.jsxs)("div",{className:"space-y-10",children:[(0,r.jsxs)("div",{className:"flex flex-row items-center text-blue-500 rounded-lg dark:text-blue-300 gap-2 text-sm",children:[(0,r.jsx)(o.A,{}),"Extracting table and column metadata helps our AI generate more accurate SQL queries."]}),(0,r.jsxs)("div",{className:"flex flex-row items-start gap-2 w-full border-b pb-10",children:[n&&(0,r.jsx)(u.KF,{placeholder:"Select tables for metadata extraction. Leave empty to process all tables.",options:S,value:x,allowCreateNewOption:!1,onChange:e=>{if(e.indexOf("all")>-1){b(n);return}if(e.indexOf("clear")>-1){b([]);return}b(e)},rootClassNames:"max-w-full grow"}),(0,r.jsxs)(u.$n,{onClick:A,disabled:v,variant:"primary",className:"flex flex-col gap-2 min-h-full",children:[(0,r.jsx)(d.A,{}),"Extract AI Metadata"]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium dark:text-dark-text-primary",children:"Current Metadata"}),(0,r.jsx)(u.XI,{rootClassNames:"!p-0",columns:E,rows:D,pagination:{defaultPageSize:10,showSizeChanger:!0},paginationPosition:"bottom",rowCellRender:e=>{let{cellValue:t,row:a,dataIndex:s,column:l}=e;return"function"==typeof l.render?(0,r.jsx)("td",{className:"px-3 py-2 align-top text-sm text-gray-700 dark:text-gray-200",children:l.render(t,a)},"".concat(a.key,"-").concat(s)):(0,r.jsx)("td",{className:"px-3 py-2  align-top text-sm text-gray-700 dark:text-gray-200",children:t},"".concat(a.key,"-").concat(s))}}),(0,r.jsxs)("div",{className:"flex justify-center my-4 gap-4",children:[(0,r.jsxs)(u.$n,{disabled:v,onClick:O,children:[(0,r.jsx)("span",{children:"Download"})," ",(0,r.jsx)(i.A,{className:"h-4 w-4"})]}),(0,r.jsxs)(u.$n,{disabled:v,onClick:T,children:[(0,r.jsx)("span",{children:"Upload"})," ",(0,r.jsx)(c.A,{className:"h-4 w-4"})]})]})]})]})};var b=a(4398);let g=async(e,t)=>{let a=await fetch((0,m.A)("http","integration/get_db_info"),{method:"POST",body:JSON.stringify({token:e,db_name:t}),headers:{"Content-Type":"application/json"}});if(a.ok)return await a.json();throw Error("Failed to get tables and db creds")},f=async(e,t)=>{let a=await fetch((0,m.A)("http","integration/delete_db_info"),{method:"POST",body:JSON.stringify({token:e,db_name:t}),headers:{"Content-Type":"application/json"}});if(a.ok)return await a.json();throw Error("Failed to delete db info")},y={EXCEL:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",OLD_EXCEL:"application/vnd.ms-excel",CSV:"text/csv"},j={PDF:"application/pdf"};function v(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?Object.values({...y,...j}).includes(e):Object.values(y).includes(e)}let w={postgres:["host","port","user","password","database"],mysql:["host","user","password","database"],redshift:["host","port","user","password","database","schema"],snowflake:["account","warehouse","user","password"],databricks:["server_hostname","access_token","http_path","schema"],bigquery:["credentials_file_content"],sqlserver:["server","database","user","password"]},k={host:"host.docker.internal",port:"5432",user:"Database User",database:"Database Name",server_hostname:"Server Hostname",access_token:"Access Token",http_path:"HTTP Path",schema:"Schema"},N={db_name:"",db_type:"postgres",db_creds:{host:"",port:"",user:"",password:"",database:""}},_=e=>{let{token:t="",existingDbInfo:a=null,onDbUpdatedOrCreated:l=()=>{}}=e,[n,o]=(0,s.useState)(!1),d=(0,s.useContext)(u.oS),[i,c]=(0,s.useState)({...N,...a});(0,s.useEffect)(()=>{a&&c({...N,...a})},[a]);let p=async e=>{e.preventDefault();let a={token:t,db_name:i.db_name,db_type:i.db_type,db_creds:i.db_creds};try{o(!0);let e=await fetch((0,m.A)("http","integration/update_db_creds"),{method:"POST",body:JSON.stringify(a)});if(!e.ok)throw Error("Could not update db creds");let t=await e.json();l(t.db_name,t)}catch(e){console.log(e),d.error(e.message)}finally{o(!1)}};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(u.pd,{label:"Database nickname "+(a?"":"(This is for your reference so make it memorable. This cannot be changed later!)"),status:a&&(null==i?void 0:i.db_name)!==(null==a?void 0:a.db_name)?"error":null,type:"text",name:"db_name",value:(null==i?void 0:i.db_name)||"",onChange:e=>{c({...i,db_name:e.target.value})},disabled:a&&!0}),(0,r.jsx)(u.Z,{rootClassNames:"not-prose",allowClear:!1,label:"Database Type",value:(null==i?void 0:i.db_type)||"postgres",options:[{value:"postgres",label:"PostgreSQL"},{value:"mysql",label:"MySQL"},{value:"redshift",label:"Amazon Redshift"},{value:"snowflake",label:"Snowflake"},{value:"databricks",label:"Databricks"},{value:"bigquery",label:"Google BigQuery"},{value:"sqlserver",label:"Microsoft SQL Server"}],onChange:e=>{c({...i,db_type:e})}}),(null==i?void 0:i.db_type)&&w[i.db_type].map(e=>{var t;return(0,r.jsx)("div",{children:(0,r.jsx)(u.pd,{label:e.charAt(0).toUpperCase()+e.slice(1),type:"password"===e?"password":"text",name:e,value:(null===(t=i.db_creds)||void 0===t?void 0:t[e])||"",onChange:t=>{c({...i,db_creds:{...i.db_creds,[e]:t.target.value}})},placeholder:k[e]||"Enter ".concat(e)})},e)}),(0,r.jsx)(u.$n,{onClick:p,className:"w-full justify-center p-2",variant:"primary",disabled:n||!i.db_name,children:n?"Updating...":a?"Update":"Create"})]})})};var C=a(1072),S=a(2569),A=a(7178),E=a(9404);let D=e=>{let{loading:t,canConnect:a,areTablesIndexed:s,hasNonEmptyDescription:l}=e,n=[{key:"1",title:"Database Setup",description:t?(0,r.jsx)(C.A,{className:"text-gray-500 dark:text-dark-text-primary h-5 w-5"}):a?"Database connection verified":"We could not connect to your database. Please check your connection details.",status:t?(0,r.jsx)(C.A,{className:"text-gray-500 dark:text-dark-text-primary h-5 w-5"}):a?(0,r.jsx)(S.A,{className:"text-[#96c880] h-5 w-5"}):(0,r.jsx)(A.A,{className:"text-[#fc8e8e] h-5 w-5"})},{key:"2",title:"Metadata Setup",description:t?(0,r.jsx)(C.A,{className:"text-gray-500 dark:text-dark-text-primary h-5 w-5"}):s?"AI metadata generated for at least one table":"AI metadata not generated. Queries will be incorrect.",status:t?(0,r.jsx)(C.A,{className:"text-gray-500 dark:text-dark-text-primary h-5 w-5"}):s?(0,r.jsx)(S.A,{className:"text-[#96c880] h-5 w-5"}):(0,r.jsx)(E.A,{className:"text-yellow-500 h-5 w-5"}),blur:!a},{key:"3",title:"Column Descriptions",description:t?(0,r.jsx)(C.A,{className:"text-gray-500 dark:text-dark-text-primary h-5 w-5"}):l?"We found at least one column with a description. You can view and update the metadata.":"We did not find any column descriptions. Queries will be incorrect.",status:t?(0,r.jsx)(C.A,{className:"text-gray-500 dark:text-dark-text-primary h-5 w-5"}):l?(0,r.jsx)(S.A,{className:"text-[#96c880] h-5 w-5"}):(0,r.jsx)(E.A,{className:"text-yellow-500 h-5 w-5"}),blur:!a}];return(0,r.jsx)("div",{className:"mt-4 flex flex-row gap-4",children:n.map(e=>(0,r.jsx)("div",{className:"w-1/3 ".concat(e.blur?"filter blur-sm pointer-events-none opacity-60":""),children:(0,r.jsxs)("div",{className:"h-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-dark-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-between dark:text-dark-text-primary",children:[(0,r.jsx)("span",{className:"text-base font-medium",children:e.title}),(0,r.jsx)("span",{children:e.status})]})}),(0,r.jsx)("div",{className:"px-6 py-4",children:(0,r.jsx)("p",{className:"text-gray-600 dark:text-dark-text-secondary text-sm",children:e.description})})]})},e.key))})};var O=a(2856),T=a(2910),P=a(4799);function F(e){let{uploadFiles:t=()=>{},fileUploading:a}=e,l=(0,s.useContext)(u.oS),[n,o]=(0,s.useState)([]);return(0,r.jsxs)("div",{className:"h-96 relative",children:[(0,r.jsx)(u.z8,{disabled:a,acceptedFileTypes:[".csv",".xls",".xlsx",".pdf"],showIcon:!0,allowMultiple:!0,selectedFiles:n,onRemoveFile:e=>{!a&&n.length&&(console.time("OracleNewDb:onRemoveFile"),o(n.filter((t,a)=>a!==e)),console.timeEnd("OracleNewDb:onRemoveFile"))},onFileSelect:async e=>{console.time("OracleNewDb:onFileSelect"),e.preventDefault(),e.stopPropagation();try{let t=e.target.files;for(let e of t)if(!e||!v(e.type,!0))throw Error("Only CSV or Excel files are accepted");o([...n,...t])}catch(e){console.error(e),l.error("Failed to parse the file")}console.timeEnd("OracleNewDb:onFileSelect")},onDrop:async e=>{console.time("OracleNewDb:onDrop"),e.preventDefault(),e.stopPropagation();try{var t;let a=null==e?void 0:null===(t=e.dataTransfer)||void 0===t?void 0:t.items,r=[];for(let e of a){if(!e||!e.kind||"file"!==e.kind)throw Error("Invalid file");if(!v(e.type,!0))throw Error("Only CSV, Excel or PDF files are accepted");let t=e.getAsFile();r.push(t)}o([...n,...r])}catch(e){l.error(e.message||"Failed to parse the file"),console.log(e.stack)}console.timeEnd("OracleNewDb:onDrop")}}),(0,r.jsx)(u.$n,{className:(0,P.QP)("absolute bottom-10 p-4 left-0 right-0 mx-auto w-fit rounded-full z-[10] shadow-md",a||!n.length?"pointer-events-none":""),disabled:0===n.length||a,variant:"primary",onClick:async()=>{try{t(n)}catch(e){console.error("Error during file upload:",e),l.error(e.message||"Failed to upload files")}finally{}},children:n.length?a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.c5,{}),"Uploading"]}):"Click to upload":"Select some files"})]})}function I(e){let{token:t,fileUploading:a,uploadFiles:l=()=>{},onCredsSubmit:n=()=>{}}=e,o=(0,s.useMemo)(()=>[{name:"connect-db",headerContent:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"w-4"}),"Connect Database"]}),content:(0,r.jsxs)("div",{className:"prose dark:prose-invert max-w-none",children:[(0,r.jsx)("h3",{children:"Connect your database"}),(0,r.jsx)("p",{children:"Connect directly to your existing database to unlock AI-powered insights."}),(0,r.jsx)(_,{token:t,onDbUpdatedOrCreated:(e,t)=>{n(e,t)}})]})},{name:"upload-file",headerContent:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(T.A,{className:"w-4"}),"Upload CSV/Excel/PDFs"]}),content:(0,r.jsxs)("div",{className:"prose dark:prose-invert max-w-none",children:[(0,r.jsx)("h3",{children:"Upload your files here"}),(0,r.jsx)("p",{children:"You can upload CSV/Excel for analysing them. You can upload PDFs to provide more context to the model when generating insights."}),(0,r.jsx)(F,{fileUploading:a,uploadFiles:l})]})}],[a]);return(0,r.jsx)(u.tU,{tabs:o})}var U=a(3919),L=a(8598),R=a(3181),M=a(525);let Q=()=>{var e;let[t,o]=(0,s.useState)({}),[d,i]=(0,s.useState)(null),c=(0,s.useRef)(""),[m,p]=(0,s.useState)(!0),[h,y]=(0,s.useState)(!1),[j,v]=(0,s.useState)(!1),w=(0,s.useContext)(u.oS),k=(0,l.useRouter)(),N=(0,s.useRef)(null);(0,s.useEffect)(()=>(N.current||(N.current=new Worker(a.tu(new URL(a.p+a.u(503),a.b)),{type:void 0}),N.current.onmessage=e=>{let{type:t,dbName:a,dbInfo:r,error:s}=e.data;"UPLOAD_SUCCESS"===t?(w.success("DB ".concat(a," created successfully")),o(e=>({...e,[a]:r})),i(a)):"UPLOAD_ERROR"===t&&w.error(s||"Failed to upload file"),y(!1)}),()=>{N.current&&(N.current.terminate(),N.current=null)}),[w]),(0,s.useEffect)(()=>{let e=localStorage.getItem("defogToken");if(c.current=e,!e){v(!1),p(!1),setTimeout(()=>{let e=window.location.pathname+window.location.search;k.push({pathname:"/log-in",query:{message:"You are not logged in. Please log in to access database management.",returnUrl:e}})},1500);return}v(!0),(async()=>{p(!0);try{let t=await fetch((M.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!t.ok)throw Error("Failed to get api key names - are you sure your network is working?");let a=await t.json(),r=a.db_names.filter(e=>e),s={};for(let e of r){let t=await g(c.current,e);s[e]=t}i(a.db_names.length?a.db_names[0]:null),p(!1),o(s)}catch(e){w.error(e.message),console.error(e),p(!1)}})()},[k,w]);let C=t[d]&&t[d].tables&&t[d].tables.length>0,S=t[d]&&t[d].metadata&&t[d].metadata.some(e=>e.column_description&&""!==e.column_description.trim()),A=null===(e=t[d])||void 0===e?void 0:e.can_connect,E=(0,s.useId)(),O=(0,s.useMemo)(()=>{if(!Object.keys(t).length)return null;let e=Object.keys(t).map(e=>({value:e,label:e}));return e=[{value:E,label:"Start a new project"},...e],(0,r.jsx)("div",{className:"flex flex-row my-6 w-full gap-2 items-center",children:Object.keys(t).length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{disabled:h,label:"Select a project",labelClassNames:"font-bold text-sm",allowClear:!1,allowCreateNewOption:!1,options:e,value:d||void 0,onChange:e=>i(e),placeholder:"Select your DB name",rootClassNames:"flex-grow min-w-[250px] w-full",optionRenderer:e=>e.value===E?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(U.A,{className:"w-4"}),"Start a new project"]}):(0,r.jsxs)("div",{className:"whitespace-pre flex items-center gap-2",children:[(0,r.jsx)(L.A,{className:"w-4"}),e.label]})}),d!==E&&(0,r.jsx)(R.A,{className:"w-5 h-5 relative top-3 cursor-pointer hover:text-rose-500",onClick:()=>{try{f(c.current,d),w.success("Database deleted"),o(e=>{let t={...e};return delete t[d],t}),i(E)}catch(e){console.error(e),w.error("Failed to delete database")}}})]})})},[w,d,h]),T=(0,s.useMemo)(()=>!d||d===E||m?null:[{name:"Database Connection",content:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(_,{token:c.current,existingDbInfo:t[d],onDbUpdatedOrCreated:(e,t)=>{i(e),o(a=>({...a,[e]:t}))}})})},{name:"AI Metadata Management",content:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(x,{token:c.current,dbInfo:t[d],onUpdate:(e,t)=>{o(a=>({...a,[e]:t}))}})})}],[m,d,t]);return j||m?m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{}),(0,r.jsx)(b.A,{id:"manage-database",userType:"admin",children:(0,r.jsxs)("div",{className:"w-full h-96 text-gray-500 dark:bg-dark-bg-primary flex items-center justify-center",children:[(0,r.jsx)(u.c5,{}),"Loading"]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{}),(0,r.jsx)(b.A,{id:"manage-database",userType:"admin",children:(0,r.jsxs)("div",{className:"w-full dark:bg-dark-bg-primary px-2 md:px-0 mb-4",children:[O,Object.keys(t).length&&T?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D,{loading:m,canConnect:A,areTablesIndexed:C,hasNonEmptyDescription:S}),(0,r.jsx)("div",{className:"dark:bg-dark-bg-primary mt-4",children:(0,r.jsx)(u.tU,{rootClassNames:"w-full dark:bg-dark-bg-primary min-h-[500px]",tabs:T.map(e=>({...e,className:"!overflow-y-visible dark:bg-dark-bg-primary dark:text-dark-text-primary dark:hover:bg-dark-hover dark:border-dark-border",selectedClassName:"dark:bg-dark-hover dark:text-dark-text-primary dark:border-b-2 dark:border-blue-500"})),disableSingleSelect:!0,contentClassNames:"border dark:border-gray-700 border-t-none"})})]}):(0,r.jsxs)("div",{className:"prose dark:prose-invert max-w-none",children:[0===Object.keys(t).length&&(0,r.jsxs)("div",{className:"max-w-lg mx-auto text-center my-10",children:[(0,r.jsx)("h3",{children:"Welcome to Defog!"}),(0,r.jsx)("p",{children:"Let's get you set up with your first database connection. Connect your data source to start generating AI-powered SQL queries and reports."})]}),(0,r.jsx)(I,{fileUploading:h,token:c.current,uploadFiles:e=>{y(!0),N.current.postMessage({type:"UPLOAD_FILE",token:c.current,files:e})},onCredsSubmit:(e,t)=>{o(a=>({...a,[e]:t})),i(e),w.success("Database ".concat(e," created successfully"))}})]})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("div",{className:"h-screen flex flex-col items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Not Logged In"}),(0,r.jsx)("p",{className:"mb-4",children:"You are not logged in. Redirecting to login page..."}),(0,r.jsx)(u.c5,{})]})})]})}},8301:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(525);let s=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==t?"ws"===e?"".concat((r.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(t):"".concat(r.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(t):"".concat(r.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},e=>{var t=t=>e(e.s=t);e.O(0,[902,46,636,593,792],()=>t(2639)),_N_E=e.O()}]);